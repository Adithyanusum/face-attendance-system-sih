{% extends "base.html" %}
{% block title %}Attendance Records – Face Attendance System{% endblock %}

{% block content %}
<h2 class="mb-3"><i class="bi bi-list-check me-2"></i>Attendance Records</h2>

<!-- Filter -->
<form method="GET" class="row g-2 mb-3">
  <div class="col-md-4">
    <label class="form-label">Class</label>
    <select name="class_id" class="form-select">
      <option value="">— Select Class —</option>
      {% for cls in classes %}
      <option value="{{ cls.id }}"
              {% if selected_class == cls.id|string %}selected{% endif %}>
        {{ cls.name }} – {{ cls.subject }}
      </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Date</label>
    <input type="date" name="date" class="form-control" value="{{ selected_date }}">
  </div>
  <div class="col-auto align-self-end">
    <button type="submit" class="btn btn-primary">
      <i class="bi bi-search me-1"></i>View
    </button>
    {% if selected_class %}
    <a href="{{ url_for('attendance_records') }}" class="btn btn-outline-secondary">Reset</a>
    {% endif %}
  </div>
</form>

{% if selected_class %}
  {% if records %}
  <!-- Summary badges -->
  <div class="mb-3 d-flex gap-2 flex-wrap">
    {% set present_count = records | selectattr("status", "equalto", "present") | list | length %}
    {% set absent_count = records | selectattr("status", "equalto", "absent") | list | length %}
    {% set late_count = records | selectattr("status", "equalto", "late") | list | length %}
    <span class="badge bg-success fs-6">Present: {{ present_count }}</span>
    <span class="badge bg-danger fs-6">Absent: {{ absent_count }}</span>
    <span class="badge bg-warning text-dark fs-6">Late: {{ late_count }}</span>
    <span class="badge bg-secondary fs-6">Total: {{ records | length }}</span>
  </div>

  <div class="table-responsive">
    <table class="table table-hover shadow-sm" id="recordsTable">
      <thead class="table-dark">
        <tr>
          <th>#</th><th>Student ID</th><th>Name</th>
          <th>Time</th><th>Status</th><th>Marked By</th>
        </tr>
      </thead>
      <tbody>
        {% for r in records %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ r.student_id }}</td>
          <td class="fw-semibold">{{ r.name }}</td>
          <td>{{ r.time }}</td>
          <td>
            <span class="badge bg-{{ 'success' if r.status == 'present' else ('warning' if r.status == 'late' else 'danger') }}">
              {{ r.status | capitalize }}
            </span>
          </td>
          <td>
            <span class="badge bg-{{ 'primary' if r.marked_by == 'face' else 'secondary' }}">
              {{ r.marked_by | capitalize }}
            </span>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="alert alert-info">No records found for the selected class / date.</div>
  {% endif %}
{% else %}
<p class="text-muted">Select a class and date above to view attendance records.</p>
{% endif %}
{% endblock %}
